# ============================================
# GENERAL SETTINGS
# ============================================
set-option -g default-shell "$SHELL"
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g history-limit 40000
set -g mouse on
set -sg escape-time 10  # remove delay for exiting insert mode with ESC in Neovim

# Enable extended keys for better key recognition.
# Error with detecting <C-CR> or <S-CR> in neovim in linux when using tmux in ghostty, because of the kitty protocol.
set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'
set -as terminal-features '*:extkeys'

# ============================================
# PREFIX KEY
# ============================================
set -g prefix C-a
unbind C-b
bind-key C-a send-prefix

# ============================================
# WINDOW & PANE MANAGEMENT
# ============================================
# Split panes
unbind %
bind | split-window -h

unbind '"'
bind - split-window -v

# Resize panes
unbind-key Up
unbind-key Down
unbind-key Left
unbind-key Right
bind-key -r -T prefix Up    resize-pane -U 5
bind-key -r -T prefix Down  resize-pane -D 6
bind-key -r -T prefix Left  resize-pane -L 5
bind-key -r -T prefix Right resize-pane -R 5

# Maximize the size of a pane
bind -r m resize-pane -Z

# ============================================
# SESSION MANAGEMENT
# ============================================
bind C-d detach
bind b run-shell "tmux-sessionizer"
bind x confirm-before -p "Kill current session? (y/n)" kill-session

# ============================================
# UTILITIES
# ============================================
# Reload config
unbind r
bind r source-file ~/.tmux.conf

# Clear pane
bind C-k send-keys "C-l" \; clear-history

# ============================================
# COPY MODE
# ============================================
set-window-option -g mode-keys vi

# Enter copy mode
bind Enter copy-mode

# Vim-style copy mode bindings
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X begin-selection \; send -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send -X copy-selection
bind-key -T copy-mode-vi 'o' send -X copy-selection \; run-shell "~/.tmux/open-file-into-nvim.sh"
bind-key -T copy-mode-vi Escape send -X clear-selection

# Don't exit copy mode when dragging with mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# ============================================
# PLUGINS (TPM)
# ============================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'dracula/tmux'

# ============================================
# THEME CONFIGURATION (Dracula)
# ============================================
set -g @dracula-show-powerline true
set -g @dracula-fixed-location "NYC"
set -g @dracula-plugins false
set -g @dracula-show-flags false
set -g @dracula-show-left-icon session
set -g @dracula-show-battery false
set -g @dracula-refresh-rate 10

# ============================================
# INITIALIZE TPM (keep at the very bottom)
# ============================================
run '~/.tmux/plugins/tpm/tpm'

