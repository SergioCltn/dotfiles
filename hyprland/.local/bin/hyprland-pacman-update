#!/bin/bash

# Improved pacman update display

clear

echo -e "\033[1;34m══════════════════════════════════════\033[0m"
echo -e "\033[1;34m       System Update Check\033[0m"
echo -e "\033[1;34m══════════════════════════════════════\033[0m"
echo

# Check if checkupdates is available
if ! command -v checkupdates &>/dev/null; then
  echo -e "\033[1;31mError: checkupdates not found\033[0m"
  echo "Install with: sudo pacman -S pacman-contrib"
  echo
  read -p "Press enter to close..."
  exit 1
fi

echo -e "\033[1;33mChecking for updates...\033[0m"
echo

updates=$(checkupdates 2>/dev/null)
count=$(echo "$updates" | grep -c . 2>/dev/null || echo "0")

if [ -z "$updates" ] || [ "$count" -eq 0 ]; then
  echo -e "\033[1;32m✓ System is up to date!\033[0m"
  echo
  read -p "Press enter to close..."
  exit 0
fi

echo -e "\033[1;33m$count package(s) available for update:\033[0m"
echo
echo "$updates" | while read -r line; do
  pkg=$(echo "$line" | awk '{print $1}')
  ver=$(echo "$line" | awk '{print $2 " → " $4}')
  echo -e "  \033[0;36m$pkg\033[0m $ver"
done

echo
echo -e "\033[1;34m══════════════════════════════════════\033[0m"
echo

read -p "Proceed with update? [Y/n] " confirm
confirm=${confirm:-Y}

if [[ "$confirm" =~ ^[Yy]$ ]]; then
  echo
  sudo pacman -Syu
  echo
  echo -e "\033[1;32m✓ Update complete!\033[0m"
else
  echo
  echo -e "\033[1;33m⊘ Update cancelled\033[0m"
fi

echo
read -p "Press enter to close..."
